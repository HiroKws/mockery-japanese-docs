::: index
single: Mocking; finalクラス／メソッド
:::

# finalクラス／メソッドの取り扱い

PHPのモックオブジェクトの一番の制限は、final付きのクラスやメソッドをモックするのが困難なことです。finalキーワードはメソッドをサブクラスに設置することを防ぐ印です。（サブクラスにすることにより、モック対象のクラスやオブジェクトのタイプをモックオブジェクトに継承できるのです。）

簡単な解決策は、クラスやメソッドにfinalを付けないことです！

しかしながら、モックの機能とタイプの安全性間の妥協として、Mockeryはfinalの付いたクラス、もしくはfinalが付いたメソッドを持つクラスから、「プロキシモック」を生成可能です。この方法は通常のモックオブジェクトの利点を持っていますが、結果としてモックはモックしているオブジェクトのクラスタイプを継承できないため、たとえばinstanceof比較はパスしないでしょう。

例えば、モックしたいクラスをインスタンス化したオブジェクトを`\Mockery::mock()`に渡せば、プロキシモックが生成できます。それからMockeryは、その実際のオブジェクトに対するプロキシを生成し、エクスペクションを指定、一致判定する目的のために、メソッド呼び出しを選択的に横取りします。

プロキシパーシャルテストダブルについての主題は、[パーシャルテストダブル](creating_test_doubles.html#パーシャルテストダブル)章をご覧ください。
